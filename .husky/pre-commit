# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
FORBIDDEN="^(src/microfrontends/_template|src/styles)/"

# –ò—Å–ø–æ–ª—å–∑—É–µ–º `|| true`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ grep –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
violating_files=$(git diff --cached --name-only | grep -E "$FORBIDDEN" || true)

if [ -n "$violating_files" ]; then
  echo "‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö" >&2
  echo "" >&2
  echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:" >&2
  echo "$violating_files" | sed 's/^/  ‚Ä¢ /' >&2
  echo "" >&2
  echo "–î–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ." >&2
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø—ã
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤..."
npx tsc --noEmit --pretty
if [ $? -ne 0 ]; then
  echo "‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –Ω–µ –ø—Ä–æ—à–ª–∞. –ö–æ–º–º–∏—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
  exit 1
fi

# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–µ–º lint-staged (–ø—Ä–∏–º–µ–Ω—è–µ—Ç Prettier –∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º)
echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
npx lint-staged